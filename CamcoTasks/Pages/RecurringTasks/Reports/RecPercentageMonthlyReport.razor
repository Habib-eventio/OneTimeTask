@page "/recurringPercentageReport/{TaskId:int}/{MonthDuration:int}"

@using System.Data;

@if (IsLoading)
{
    <div class="text-center m-2">
        <div class="spinner-border text-success" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
}
else
{
    <div>
        <div class="text-center">
            <h3>Recurring Task Percentage Deatails Calculation</h3>
            @{
                var motnthDuration = MonthDuration * -1;
            }
            <h4>Select Month Duration: <input class="rounded" type="date" @bind-value="FromDate" />
                To <input class="rounded" type="date" @bind-value="ToDate" /> 
                <button class="btn-primary rounded" @onclick="PercentageByDateRange">Submit</button></h4>
            <h4>Month Duration: @motnthDuration</h4>
        </div>

        <div>
            @if (IsDoing)
            {
                <div class="text-center m-2">
                    <div class="spinner-border text-primary" role="status">
                        <span class="sr-only">Loading...</span>
                    </div>
                </div>
            }
            else
            {
                <table class="table table-hover">
                    <thead>
                        <tr>
                            @foreach (DataColumn col in PercentageTable.Columns)
                            {
                                <th scope="col">@col.ColumnName</th>
                            }
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (DataRow row in PercentageTable.Rows)
                        {
                            <tr>
                                <td>@row["Task Id"]</td>
                                <td>@row["Frequency"]</td>
                                <td style="white-space:pre-wrap;">@row["Task Completion Dates"]</td>
                                <td style="white-space:pre-wrap;">@row["Task Due Dates"]</td>
                                <td style="white-space:pre-wrap;">@row["Number of Misses"]</td>
                                <td style="white-space:pre-wrap;">@row["Total Number"]</td>
                                <td>@row["On Time Percentage"]</td>
                                <td>@row["Overall On Time Percentage"]</td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
        </div>

        <div class="m-5 p-3">
            <h5>Formula:</h5>
            <div class="m-1 ml-5">
                <p><span class="text-danger">*</span>Number of Misses = (Task Completion Date - Task Due Date) / Frequency [rounded up]</p>
                <p><span class="text-danger">*</span>Total Number = Number of Misses with a minimum of 1</p>
                <p><span class="text-danger">*</span>On Time Percentage = 1 - (This tasks' sum number of misses / this tasks' sum total number)</p>
                <p><span class="text-danger">*</span>Overall On Time Percentage = (1 - (Sum of all tasks' number of misses / Sum of all tasks' Total Number)) * 100</p>
            </div>
        </div>
    </div>
}
