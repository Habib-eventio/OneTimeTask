@page "/ReAssignRecTasks"

@using CamcoTasks.ViewModels.TasksRecTasksDTO;

@inherits CamcoTasks.Pages.RecurringTasks.ReAssignRecurrentTasksModel

<div class="col-12 navbar navbar-expand screenLabel position-fixed top-row m-0 p-0 screenLabelStyle">
    <div class="col-12 m-0 p-0" style="font-size: 18px; text-align: left;"><span style="float: left">Ma / Me / ReTa / ReAsReTa</span></div>
</div>

@if (IsSpinner)
{
    <Loading />
}
else
{
    <div class="row custom-top mt-1">
        <div class="col-md-6">
            <div class="">
                <h2>
                    RE-ASSIGN RECURRING TASKS
                </h2>
            </div>
        </div>
        <div class="col-md-6">
             <h2>InActive Employee and Tasks (@InActiveEmployeeCount, @InActiveTasksCount)</h2>
        </div>
    </div>

    <br />
    @if (Tasks != null)
    {

        <div class="col-lg-12 control-section">
            <div class="content-wrapper">
                <div class="row">
                    <SfGrid @ref="RecurringTasksGrid" DataSource="@employeeTasks" ID="container" AllowSelection="true"
                            AllowSorting="true" AllowFiltering="true"
                            AllowPaging="true" AllowTextWrap="true" EnableHover="false" RowHeight="38"
                            Toolbar="@(new List<object>() { "Print","Search" })">
                        <GridFilterSettings Type="Syncfusion.Blazor.Grids.FilterType.Excel"></GridFilterSettings>
                        <GridPageSettings PageSizes="true"></GridPageSettings>
                        <GridSelectionSettings CheckboxOnly="true" PersistSelection="true" Type="SelectionType.Multiple"></GridSelectionSettings>
                        <GridTemplates>
                            <DetailTemplate Context="taskContext">
                                @{
                                    var gridContext = taskContext as EmployeeTasks;
                                    <SfGrid @ref="childRecurringTasksGrid" DataSource="@gridContext.TasksRecTasks"
                                            ID="childContainer" AllowSelection="true" AllowSorting="true" AllowFiltering="true"
                                            AllowPaging="true" AllowTextWrap="true" EnableHover="false" RowHeight="38"
                                            Toolbar="@(new List<object>() { "Print","Search" })">
                                        <GridFilterSettings Type="Syncfusion.Blazor.Grids.FilterType.Excel"></GridFilterSettings>
                                        <GridPageSettings PageSizes="true"></GridPageSettings>
                                        <GridSelectionSettings CheckboxOnly="true" PersistSelection="true" Type="SelectionType.Multiple"></GridSelectionSettings>
                                        <GridColumns>
                                            <GridColumn TextAlign="TextAlign.Center" HeaderTextAlign="TextAlign.Center" 
                                                        HeaderText="UPCOMING DATE" Format="MM/dd/yyyy" Width="155"
                                                        ClipMode="ClipMode.EllipsisWithTooltip">
                                                <Template>
                                                    @{
                                                        var task = context as TasksRecTasksViewModel;
                                                        if (task.UpcomingDate < DateTime.Today && task.UpcomingDate.HasValue)
                                                        {
                                                            <label style="font-weight:bold; color:red"> @task.UpcomingDate.Value.ToString("MM/dd/yyyy") </label>
                                                        }
                                                        else
                                                        {

                                                            <label> @task.UpcomingDate.Value.ToString("MM/dd/yyyy") </label>
                                                        }
                                                    }
                                                </Template>
                                            </GridColumn>
                                            <GridColumn TextAlign="TextAlign.Center" HeaderTextAlign="TextAlign.Center" Field=@nameof(TasksRecTasksViewModel.Description) HeaderText="DESCRIPTION" Width="440" FilterSettings="@(new FilterSettings { Type = Syncfusion.Blazor.Grids.FilterType.Menu })"></GridColumn>
                                            <GridColumn TextAlign="TextAlign.Center" HeaderTextAlign="TextAlign.Center" Field=@nameof(TasksRecTasksViewModel.DateCompleted) HeaderText="LAST DATE COMPLETED" Width="155" Format="MM/dd/yyyy" FilterSettings="@(new FilterSettings { Type = Syncfusion.Blazor.Grids.FilterType.Menu })" ClipMode="ClipMode.EllipsisWithTooltip"></GridColumn>
                                            <GridColumn TextAlign="TextAlign.Center" HeaderTextAlign="TextAlign.Center" Field=@nameof(TasksRecTasksViewModel.Frequency) HeaderText="FREQUENCY" Width="135" ClipMode="ClipMode.EllipsisWithTooltip"></GridColumn>
                                            <GridColumn TextAlign="TextAlign.Center" HeaderTextAlign="TextAlign.Center" Field=@nameof(TasksRecTasksViewModel.Initiator) HeaderText="INITIATOR" Width="180" ClipMode="ClipMode.EllipsisWithTooltip"></GridColumn>
                                            <GridColumn TextAlign="TextAlign.Center" HeaderTextAlign="TextAlign.Center" HeaderText="ACTION" ClipMode="ClipMode.EllipsisWithTooltip">
                                                <Template>
                                                    @{
                                                        <a data-placement="top" title="Edit Task" data-toggle="tooltip" type="button"
                                                           style="font-size: 12px; margin-left: 3px; min-width: 45px; margin-bottom: 3px;"
                                                           @onclick="(e => EditItem((context as TasksRecTasksViewModel),gridContext))">
                                                            <img src="/Icons/Finalized/Edit Button/Power User/Png Files/E2 30x30.png" class="icon" />
                                                        </a>
                                                        <a data-placement="top" title="Edit Task" data-toggle="tooltip" type="button"
                                                           style="font-size: 12px; margin-left: 3px; min-width: 45px; margin-bottom: 3px;"
                                                           @onclick="(e => DeleteTask((context as TasksRecTasksViewModel),gridContext))">
                                                            <img src="/Icons/Finalized/Delete Button/Power User/Png Files/D3 30x30.png" class="icon" />
                                                        </a>
                                                    }
                                                </Template>
                                            </GridColumn>
                                        </GridColumns>
                                    </SfGrid>
                                }
                            </DetailTemplate>
                        </GridTemplates>

                        <GridColumns>
                            <GridColumn TextAlign="TextAlign.Center" HeaderTextAlign="TextAlign.Center" Field=@nameof(EmployeeTasks.Name) HeaderText="PERSON RESPONSIBLE" Width="210" Visible="true" IsPrimaryKey="false"></GridColumn>
                            <GridColumn TextAlign="TextAlign.Center" HeaderTextAlign="TextAlign.Center" Field=@nameof(EmployeeTasks.TasksCount) HeaderText="TASKS COUNT" Width="210" Visible="true" IsPrimaryKey="false"></GridColumn>
                            <GridColumn TextAlign="TextAlign.Center" HeaderTextAlign="TextAlign.Center" HeaderText="FIX ALL" Width="200"
                                        ClipMode="ClipMode.EllipsisWithTooltip">
                                <Template>
                                    @{
                                        <a href="javascript:void(0);" class="btn btn-primary no-print"
                                           role="button" data-placement="top" title="" data-original-title="Add"
                                           data-toggle="modal" data-target="#FixModel" style="margin: 5px;"
                                           @onclick="(e => StartFixAllTasks(context as EmployeeTasks))">REASSIGN ALL</a>
                                        <a href="javascript:void(0);" class="btn btn-danger no-print"
                                           role="button" data-placement="top" title="" data-original-title="Add"
                                           data-toggle="modal" data-target="#deleteRecurringTask" style="margin: 5px;"
                                           @onclick="(e => StartDeleteTasks(context as EmployeeTasks))">DELETE ALL</a>
                                    }
                                </Template>
                            </GridColumn>
                        </GridColumns>
                    </SfGrid>
                </div>
            </div>
        </div>

        <div class="modal fade" id="deleteRecurringTask" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">DELETE TASK</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        </button>
                    </div>
                    <div class="modal-body">
                        <h4>Do you want to delete?</h4>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-warning" data-dismiss="modal"><i class="flaticon-cancel-12"></i> NO</button>
                        <button type="button" data-dismiss="modal" class="btn btn-primary"
                                @onclick="(async () => await ConfirmDelete())">
                            YES
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="FixModel" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">FIX TASK</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-12 form-group">
                                <label style="float:left;" class="col-form-label">PERSON RESPONSIBLE:</label>
                                <SfComboBox CssClass="BackgroundCustom" TItem="string" TValue="string" DataSource="@activeEmployees"
                                            Autofill="true" AllowFiltering="true" FilterType="Syncfusion.Blazor.DropDowns.FilterType.Contains"
                                            @bind-Value="SelectedEmployee"></SfComboBox>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-danger" data-dismiss="modal"><i class="flaticon-cancel-12"></i>CANCEL</button>
                        <button type="button" class="btn btn-success"
                                @onclick="(async () => await FixAllTasks())">
                            SAVE
                        </button>
                    </div>
                </div>
            </div>
        </div>

    }
    else
    {
        <p><em>LOADING...</em></p>
    }

    <style type="text/css" class="cssStyles">
        .e-grid .e-altrow {
            /*background-color: #DBD7E3;*/
            background-color: #EBEBEB;
        }
    </style>

    <style>
        a, a:hover, .highcontrast #dialog a, .highcontrast #dialog a:hover {
            color: inherit;
            text-decoration: none;
        }

        .fabric #target .e-dialog {
            height: 306px;
        }

        .material #target .e-dialog {
            height: 270px;
        }

        .bootstrap4 #target .e-dialog {
            height: 305px;
        }

        #target .e-dialog {
            height: 270px;
        }

        #target {
            height: 500px;
        }

        .e-grid .e-headercell {
            background-color: #24202C;
            color: white;
        }

        .e-grid .e-altrow {
            background-color: #DBD7E3;
        }

        .e-grid .e-detailindentcell {
            background-color: #EB711D;
        }

        .e-grid e-detailrowexpand {
            background-color: #EB711D;
        }

        .e-grid .e-rowcell {
            text-transform: uppercase;
        }
    </style>



}